using NUnit.Framework;
using ZBase.UnityScreenNavigator.Foundation;
using ZBase.UnityScreenNavigator.Foundation.Animation;

namespace ZBase.UnityScreenNavigator.Tests.PlayMode.Foundation
{
    public class AnimationPlayerTest
    {
        [Test]
        public void Play_Progressing()
        {
            const float duration = 1.0f;
            var animation = new FakeAnimation(duration);
            var player = Pool<AnimationPlayer>.Shared.Rent();
            player.Initialize(animation);
            player.Play();
            Assert.That(animation.Progress, Is.EqualTo(0.0f));
            player.Update(0.1f);
            Assert.That(animation.Progress, Is.EqualTo(0.1f / 1.0f));
        }
        
        [Test]
        public void NotPlay_NotProgressing()
        {
            const float duration = 1.0f;
            var animation = new FakeAnimation(duration);
            var player = Pool<AnimationPlayer>.Shared.Rent();
            player.Initialize(animation);
            Assert.That(animation.Progress, Is.EqualTo(0.0f));
            player.Update(0.1f);
            Assert.That(animation.Progress, Is.EqualTo(0.0f));
        }
        
        [Test]
        public void Stop_NotProgressing()
        {
            const float duration = 1.0f;
            var animation = new FakeAnimation(duration);
            var player = Pool<AnimationPlayer>.Shared.Rent();
            player.Initialize(animation);
            player.Play();
            Assert.That(animation.Progress, Is.EqualTo(0.0f));
            player.Update(0.1f);
            Assert.That(animation.Progress, Is.EqualTo(0.1f / 1.0f));
            player.Stop();
            player.Update(0.1f);
            Assert.That(animation.Progress, Is.EqualTo(0.1f / 1.0f));
        }
        
        [Test]
        public void Reset_CanReset()
        {
            const float duration = 1.0f;
            var animation = new FakeAnimation(duration);
            var player = Pool<AnimationPlayer>.Shared.Rent();
            player.Initialize(animation);
            player.Play();
            Assert.That(animation.Progress, Is.EqualTo(0.0f));
            player.Update(0.1f);
            Assert.That(animation.Progress, Is.EqualTo(0.1f / 1.0f));
            player.Reset();
            Assert.That(animation.Progress, Is.EqualTo(0.0f));
        }
        
        [Test]
        public void SetTime_CanSet()
        {
            const float duration = 1.0f;
            var animation = new FakeAnimation(duration);
            var player = Pool<AnimationPlayer>.Shared.Rent();
            player.Initialize(animation);
            player.SetTime(0.3f);
            Assert.That(animation.Progress, Is.EqualTo(0.3f));
        }
        
        [Test]
        public void SetTime_NegativeValue_ProgressIsZero()
        {
            const float duration = 1.0f;
            var animation = new FakeAnimation(duration);
            var player = Pool<AnimationPlayer>.Shared.Rent();
            player.Initialize(animation);
            player.SetTime(-1f);
            Assert.That(animation.Progress, Is.EqualTo(0.0f));
        }
        
        [Test]
        public void SetTime_LargeValue_ProgressIsOne()
        {
            const float duration = 1.0f;
            var animation = new FakeAnimation(duration);
            var player = Pool<AnimationPlayer>.Shared.Rent();
            player.Initialize(animation);
            player.SetTime(float.MaxValue);
            Assert.That(animation.Progress, Is.EqualTo(1.0f));
        }
        
        [Test]
        public void IsFinished_SetTimeBeyondDuration_True()
        {
            const float duration = 1.0f;
            var animation = new FakeAnimation(duration);
            var player = Pool<AnimationPlayer>.Shared.Rent();
            player.Initialize(animation);
            player.SetTime(float.MaxValue);
            Assert.That(player.IsFinished, Is.True);
        }
    }
}
